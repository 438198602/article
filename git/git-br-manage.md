## git很方便，但有时候你很苦恼

有句话不是这样说的吗——‘太方便了，往往就造成了不方便’。

使用git我们可以在毫秒之间搞定分支的创建、切换，但也是因为这样，不合理的使用造成了分支的混乱，以前看了git的一些入门文章，感觉git就是这样so easy，但是到实际的开发中，我发现问题重重，有时候会让自己我所适从，静下心来思考，发现自己只是学会了git基本命令的使用，而不是真正的git使用，发现了问题所在是心太浮躁。

因此，不要把一些东西想的方便了，它只不过是做起来方便。

最近两个多月来一直在做项目，忙里抽闲重新做又把git知识点梳理了一下，做个小结。不足之处，敬请指出。

### git分支管理策略

不合理的使用分支，是你对git分支管理策略理解不透。想明白这点，我开始看一些关于分支策略的文章，有阮一峰老师的，还有 Vincent Driessen 这个老外的，插入一点个人对翻译外文文章的看法，对于这些翻译的文章，我发现很多没有翻译到位，正是哪些没翻译到位的地方让我们在开发的时候遇到问题，有时也是造成我们固执己见的原因，所以建议有能力的还是看原文，原汁原味的往往会给你意想不到的收获。

### 1.主分支

主分支只能有一个，这个分支保存的是发布给用户的正式版本。我们一般默认为master，master这个分支它是我们创建项目是系统为我们创建的默认分支，它和其他的分支没有什么本质上的区别，但是在实际的开发中，我们将这个系统创建的默认分支定义为主分支，是任何其他新建分支的源头。


### 2.开发分支

在开发中我们会根据需要先创建不同的本地分支（例如：修改bug的bug分支，更新模块内容的update分支，添加新功能的feature分支等），在我们完成这些功能时，我们首先会进行本地测试，测试无误后，会将新建的分支编译然后合并的本地master分支，紧接着上测服，测试通过后，将本地master分支上传到版本管理服务器上自己的分支下面，紧接着会向项目管理员发送一个 merge request，请求通过后，就是新版本的发布。

从上面的项目开发流程，我们知道项目在开发过程中围绕着的不是master分支，而是新建的分支。

再次强调一下，主分支是用来发布项目使用的，日常开发中我们要在另外的分支上完成，我们通常把这类分支统称为开发分支。

这种分支不会影响到主分支，在这种分支上我们可以进行任何操作。

创建开发分支的命令：

	git checkout -b [develop name] master

当我们切换到开发分支时，需要先更新master分支，要保持和远程仓库一致。

### 3.提测新功能

在开发中，一旦我们觉得某功能开发完毕，已经没有问题，我们就需要进行提测，这是我们就需要将开发分支合并到master分支上，那么我们需要这样做：

1，从开发分支切换到master分支：

	git checkout master

2，将开发分支合并到master分支：

	git merge --no-ff [develop name]

3，将本地master分支部署到测试服务器上：

	这里由于不同的项目使用的是不同的发布工具，所以，就不介绍了，各位根据自己的实际情况操作即可。

在这里我们操作了本地仓库master，但只要一般不建议这样使用，但只要严格控制流程，操作本地master也不无不可。

注意：如果这是一个人开发项目没什么问题，如果是多人协作开发，我们就需要做如下修改：

在向master分支合并前，我们会发提测通知，提测通知会以邮件的形式通知其他相关开发人员，收到通知的其他开发人员会在体测人员提测完成前不向版本服务器发送合并请求，其实最重要的是向项目管理员发出通知，暂时不在处理版本合并请求。

1, 查看是否在本地master分支，如果不是切换到本地master分支：

	git checkout master

2, 我们合并前需要先从远程拉取最新的项目：
	
	git pull

3, 执行合并开发分支的命令
	
	git merge [develop name]

4，如果这时出现合并冲突，我们首先需要手动解决冲突（也有工具），完成后继续合并，如果还有冲突继续解决，直到没有冲突，执行下一步提测。

5，这一步与一个人开发一样，根据之际项目的情况来操作。

项目提测后，就可以通知项目管理员继续处理合并请求了。

如果测试有问题，继续重复以上步骤。

因为一个大项目可能有几个测服务，或者在你进行修改时，其他开发人员又进行了提测，并且提测通过，并将修改上传到了版本管理服务器。


### 上传新功能到版本管理服务器

1，就是将自己的本地仓库上传到远程仓库：

	git ps origin [自己的远程分支名]

2, 如果没有自己的远程分支，需要先创建自己的远程分支：

	git ckeckout -b [远程自己分支所对应的本地分支名]

	git push -u origin [远程分支名]

3，将开发分支合并到自己的本地分支上
	
	git merge [develop name]

4, 推送自己的本地分支到自己的远程分支上

	git push

5, 请求远程合并
	
这个操作我们一般实在可视化工具上进行操作，使用过github的同学都知道，将自己的本地分支推送到远程分支上后，在GitHub的项目上会显示合并请求的按钮，这里只有管理员有权限操作处理合并请求，如果同意，本地开发分支的新功能将合并到远程主分支上。

但是多人协作时，我们每次在功能测试完成后要上传版本管理器之前，也要进行功能冲突检测，先要拉取远程master到自己远程分支所对应的本地分支，如果有冲突就解决，解决完成后根据情况来确定是否需要重新测试；若没有冲突没有就上传版本管理服务器，请求合并。

### 项目管理员如何管理合并请求

前面已经讲过主分支，开发分支，提测，上传版本管理服务器，接下来我们就要说一说，项目管理员该如何管理一个项目。

项目管理员他在git项目版本控制中很重要，他管理着项目的合并请求的处理，一般也只有它能管理。他需要持续的观查是否有项目提测请求，一般邮件形式，同时它根据项目版本管理规则来处理合并请求，如果有冲突就以邮件的形式通知开发人员解决冲突，如果是想我么上面所说的团队较小，一旦一个开发人员发出提测请求管理员从这时开始不接受其他合并请求，直到该开发人员提交完成合并请求为止，如果是该开发人员需要继续修复bug，这时就需要测试人员发提测不通过邮件，这时项目管理员可以处理其他的合并请求。

项目管理人员在这里需要即时查看开发人员和测试人员的邮件，或者其他形式的项目新功能状态信息。

这个开发的流程只是讲述了大致的过程，不同的公司根据自己的情况有不同的流程，只要形成一个闭环就行了。

但是这样做还是不好，在我们开发时我们往往会有新模块添加的时候，它和任何其他模块没有交集，这时我们，要是有一个提交文档说明就好了，管理人员只用关心合并请求的模块是什么类型就行了，是模块修改的就暂时以第一个认为标准，如果是新模块添加，就直接合并即可。

说到这里项目的开发大致流程已经讲完了，但是还有一些问题我们需要注意：


### 临时分支

在版本库中主要有两条分支，Master和开发分支。前者属于正式发布，后者属于日常开发，一般需要这两个分支就可以了。但是还有一些临时性的分支，用于特定的目的，

远程仓库只要有master和开发分支就可以了，也比较常见，但是在本地仓库中，临时性分支就比较常用，根据不同的目的主要分为如下三种：

* 功能（feature）性分支
* 修补bug（fixbug）性分支
* 预发布（release）性分支（这个分支一般被开发分支取代）

这三种分支由于其临时性，使用过后就可以删除，使得代码库中一直只有master和开发分支。

1.功能分支

功能分支它是为了开发某种特定功能从开发分支上分出来的。开发完成后在并入开发分支中。

创建一个功能分支：
	
	git checkout -b feature-x [develop name]

完成后，合并功能分支到开发分支：
	
	git checkout [develop name]

	git merge --no-ff feature-x

删除功能分支：

	git branch -d feature-x


2.修补bug分支

修补bug一般发生在我们应用发布后，这时就需要修创建一个bug分支来进行bug修补。

所以修补bug分支使用master分支中切出来的，修补过后我们要先向开发分支合并，提测无误后向远程仓库的master合并。一般采用 `fixbug-*` 的形式命名。

创建一个修补bug分支：

	git checkout -b fixbug-[bug name] master

修补结速后合并到master
	
	git checkout master
	
	git merge --no-ff fixbug-[bug name]

	git tag -a [版本号]

提测

跟正常的测试流程相似

以下流程跟开发功能分支的相似，只不过不影响其他人的提测和合并请求，因为一般不存在冲突（一个人解决bug情况）

在我们做新功能模块添加时，一般不影响管理员处理合并请求，只有在开发人员之间开发的功能有重叠时，才会出现这种问题。我们这时只要按照一般开发流程来处理即可。
